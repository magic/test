<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/test/favicon.ico"/><link rel="stylesheet" href="/test/magic.css" integrity="sha384-dhpx34D1t1/ugddlEXbXuBKGImlDuoKNCeXWz6W57EV6rGwF7Mv1YsSG9zktPDaX" crossorigin="anonymous"/></head><body><div id="Magic"><div class="Wrapper"><header class="Header"><a class="LogoWrapper" href="/test/"><span class="LogoText">@magic/test</span></a><nav class="Menu"><ul><li class="MenuItem"><a href="/test/#dependencies">dependencies</a></li><li class="MenuItem"><a href="/test/#getting-started">getting started</a></li><li class="MenuItem"><a href="/test/#test-suites">test suites</a></li><li class="MenuItem"><a href="/test/#tests">writing tests</a></li><li class="MenuItem"><a href="/test/#lib">utility functions</a></li><li class="MenuItem"><a href="/test/#usage">Cli / Js Api Usage</a></li></ul></nav></header><div class="Page"><h1>@magic/test</h1><p>simple tests with lots of utility.</p><ul class="GitBadges"><li><a href="https://www.npmjs.com/package/@magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/@magic/test.svg" role="presentation" alt=""/></a></li><li><a href="https://travis-ci.com/magic/test" target="_blank" rel="noopener"><img src="https://travis-ci.com/magic/test.svg?branch=master" role="presentation" alt=""/></a></li><li><a href="https://ci.appveyor.com/project/magic/test/branch/master" target="_blank" rel="noopener"><img src="https://img.shields.io/appveyor/ci/magic/test/master.svg" role="presentation" alt=""/></a></li><li><a href="https://coveralls.io/github/magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/coveralls/github/magic/test/master.svg" role="presentation" alt=""/></a></li><li><a href="https://greenkeeper.io" target="_blank" rel="noopener"><img src="https://badges.greenkeeper.io/magic/test.svg" role="presentation" alt=""/></a></li><li><a href="https://snyk.io/test/github/magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/snyk/vulnerabilities/github/magic/test.svg" role="presentation" alt=""/></a></li></ul><h2 id="dependencies">dependencies</h2><p><a href="https://github.com/magic/log" target="_blank" rel="noopener">@magic/log</a>: console.log wrapper with loglevels</p><p><a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a>: type checking library</p><p><a href="https://github.com/magic/deep" target="_blank" rel="noopener">@magic/deep</a>: deeply compare and manipulate arrays and objects</p><p><a href="https://www.npmjs.com/package/nyc" target="_blank" rel="noopener">nyc</a>: code coverage</p><p><a href="https://www.npmjs.com/package/prettier" target="_blank" rel="noopener">prettier</a>: code formatting</p><p>@magic/log and @magic/types have no dependencies.</p><h2 id="getting-started">Getting started</h2><p>be in a nodejs project.</p><h3 id="getting-started-install">install</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm i --save-dev @magic/test</code></pre></div><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// create test/<span class="object">functionName</span>.<span class="property">js</span></span></code><code class="line"><span class="keyword">const</span> yourTest = <span class="keyword">require</span>(<span class="string">&#39;../path/to/your/<span class="object">file</span>.<span class="property">js</span>&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  { <span class="colon">fn</span>: () =&gt; <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;<span class="boolean">true</span> is <span class="boolean">true</span>&#39;</span> },</code><code class="line"><span class="comment">  // note that the <span class="keyword">function</span> will be called automagically</span></code><code class="line">  { <span class="colon">fn</span>: yourTest, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;hope <span class="keyword">this</span> will work ;)&#39;</span>}</code><code class="line">]</code></pre></div><h3 id="getting-started-npm-scripts">npm run scripts</h3><p>edit package.json</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">{</code><code class="line">  <span class="string">&#39;scripts&#39;</span>: {</code><code class="line">    <span class="string">&#39;test&#39;</span>: <span class="string">&#39;t -p&#39;</span>, <span class="comment">// quick test, only failing tests log</span></code><code class="line">    <span class="string">&#39;coverage&#39;</span>: <span class="string">&#39;t&#39;</span>, <span class="comment">// <span class="keyword">get</span> full test output and coverage reports</span></code><code class="line">    <span class="string">&#39;format&#39;</span>: <span class="string">&#39;f -w&#39;</span>, <span class="comment">// format using prettier and write changes to files</span></code><code class="line">    <span class="string">&#39;<span class="colon">format</span>:check&#39;</span>: <span class="string">&#39;f&#39;</span> <span class="comment">// check format using prettier</span></code><code class="line">  }</code><code class="line">}</code></pre></div><p>repeated for easy copy pasting (without comments)</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="string">&#39;scripts&#39;</span>: {</code><code class="line">    <span class="string">&#39;test&#39;</span>: <span class="string">&#39;t -p&#39;</span>,</code><code class="line">    <span class="string">&#39;coverage&#39;</span>: <span class="string">&#39;t&#39;</span>,</code><code class="line">    <span class="string">&#39;format&#39;</span>: <span class="string">&#39;f -w&#39;</span>,</code><code class="line">    <span class="string">&#39;<span class="colon">format</span>:check&#39;</span>: <span class="string">&#39;f&#39;</span></code><code class="line">  }</code></pre></div><h3 id="getting-started-quick-tests">quick tests (without coverage)</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// run the <span class="colon">tests</span>:</span></code><code class="line">npm test</code><code class="line"></code><code class="line"><span class="comment">// example <span class="colon">output</span>:</span></code><code class="line"><span class="comment">// (failing tests will print, passing tests are silent)</span></code><code class="line"></code><code class="line"><span class="comment">// ### Testing <span class="colon">package</span>: @magic/test</span></code><code class="line"><span class="comment">// Ran 2 tests. Passed 2/2 100%</span></code></pre></div><h3 id="getting-started-coverage">coverage</h3><p>run coverage reports and get full test report including from passing tests</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm run coverage</code></pre></div><h3 id="test-suites">data/fs driven test suite creation:</h3><h4>expectations for optimal test messages:</h4><p>src and test directories have the same structure and files</p><p>tests one src file per test file</p><p>tests one function per suite</p><p>tests one feature per test</p><h4 id="test-suites-fs">Filesystem based naming</h4><p>the following directory structure:</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">./test/</code><code class="line">  ./<span class="object">suite1</span>.<span class="property">js</span></code><code class="line">  ./<span class="object">suite2</span>.<span class="property">js</span></code></pre></div><p>yields the same result as exporting the following from ./test/index.js</p><h4 id="test-suites-data">Data driven naming</h4><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> suite1 = <span class="keyword">require</span>(<span class="string">&#39;./suite1&#39;</span>)</code><code class="line"><span class="keyword">const</span> suite2 = <span class="keyword">require</span>(<span class="string">&#39;./suite2&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  suite1,</code><code class="line">  suite2,</code><code class="line">}</code></pre></div><h3>Important - File mappings</h3><p>if test/index.js exists, no other files will be loaded.</p><p>if test/lib/index.js exists, no other files from that subdirectory will be loaded.</p><h3 id="tests">single test, literal value, function or promise</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="colon">expect</span>: <span class="boolean">true</span> is the <span class="keyword">default</span> and can be omitted</span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> fn is a <span class="keyword">function</span> expect is the returned value of the <span class="keyword">function</span></span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: () =&gt; <span class="boolean">false</span>, <span class="colon">expect</span>: <span class="boolean">false</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> expect is a <span class="keyword">function</span> the <span class="keyword">return</span> value of the test <span class="keyword">get</span> passed to it</span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">false</span>, <span class="colon">expect</span>: t =&gt; t === <span class="boolean">false</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> fn is a promise the resolved value will be returned</span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="keyword">new</span> <span class="builtin">Promise</span>(r =&gt; r(<span class="boolean">true</span>)), <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> expects is a promise it will resolve before being compared to the fn <span class="keyword">return</span> value</span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="keyword">new</span> <span class="builtin">Promise</span>(r =&gt; r(<span class="boolean">true</span>)), <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// callback functions can be tested easily <span class="colon">too</span>:</span></code><code class="line"><span class="keyword">const</span> { promise } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">const</span> fnWithCallback = (err, arg, cb) =&gt; cb(err, arg)</code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: promise(fnWithCallback(<span class="keyword">null</span>, <span class="string">&#39;arg&#39;</span>, (e, a) =&gt; a)), <span class="colon">expect</span>: <span class="string">&#39;arg&#39;</span> }</code></pre></div><h4 id="tests-types">testing types</h4><p>types can be compared using <a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a></p><p>@magic/types is a richly featured and thoroughly tested type library without dependencies. it is exported from this library for convenience.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { is } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  { <span class="colon">fn</span>: () =&gt; <span class="string">&#39;string&#39;</span>,</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">string</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;test <span class="keyword">if</span> a <span class="keyword">function</span> returns a string&#39;</span></code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; <span class="string">&#39;string&#39;</span>,</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">length</span>.<span class="property">equal</span>(6),</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;test length of returned value&#39;</span></code><code class="line">  },</code><code class="line"><span class="comment">  // !!! Testing <span class="keyword">for</span> deep equality. <span class="object">simple</span>.</span></code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; [1, 2, 3],</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">deep</span>.<span class="property">equal</span>([1, 2, 3]),</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;deep compare arrays/objects <span class="keyword">for</span> equality&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; { <span class="colon">key</span>: 1 },</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">deep</span>.<span class="property">different</span>({ <span class="colon">value</span>: 1 }),</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;deep compare arrays/objects <span class="keyword">for</span> difference&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h4>caveat:</h4><p>if you want to test if a function is a function, you need to wrap the function</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { is } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span> fnToTest = () =&gt; {}</code><code class="line"><span class="comment">// both the tests will work as expected</span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; fnToTest,</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="keyword">function</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;<span class="keyword">function</span> is a <span class="keyword">function</span>&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: <span class="object">is</span>.<span class="property">fn</span>(fnToTest), <span class="comment">// returns <span class="boolean">true</span></span></code><code class="line"><span class="comment">    // we <span class="keyword">do</span> not set <span class="colon">expect</span>: <span class="boolean">true</span>, since that is the <span class="keyword">default</span></span></code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;<span class="keyword">function</span> is a <span class="keyword">function</span>&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// will not work as expected and instead call fnToTest</span></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">fn</span>: fnToTest,</code><code class="line">  <span class="colon">expect</span>: <span class="object">is</span>.<span class="keyword">function</span>,</code><code class="line">  <span class="colon">info</span>: <span class="string">&#39;<span class="keyword">function</span> is a <span class="keyword">function</span>&#39;</span>,</code><code class="line">}</code></pre></div><h3 id="tests-multiple"> multiple tests</h3><p>multiple tests can be created by exporting an array of single test objects.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">multipleTests</span>: [</code><code class="line">    { <span class="colon">fn</span>: () =&gt; <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> },</code><code class="line">    { <span class="colon">fn</span>: () =&gt; <span class="boolean">false</span>, <span class="colon">expect</span>: <span class="boolean">false</span>, <span class="colon">info</span>: <span class="string">&#39;expect <span class="boolean">false</span> to be <span class="boolean">false</span>&#39;</span> },</code><code class="line">  ]</code><code class="line">}</code></pre></div><h3 id="tests-promises">promises</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { promise, is } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line"><span class="comment">  // kinda clumsy, but works. until you <span class="keyword">try</span> handling <span class="object">errors</span>.</span></code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: <span class="keyword">new</span> <span class="builtin">Promise</span>(cb =&gt; setTimeOut(() =&gt; cb(<span class="boolean">true</span>), 2000)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promises&#39;</span>,</code><code class="line">  },</code><code class="line"><span class="comment">  // better!</span></code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">null</span>, <span class="boolean">true</span>), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promises <span class="keyword">in</span> a nicer way&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">new</span> Error(<span class="string">&#39;error&#39;</span>)), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promise errors <span class="keyword">in</span> a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-cb">callback functions</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { promise, is } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span> fnWithCallback = (err, arg, cb) =&gt; cb(err, arg)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; fnWithCallback(<span class="keyword">null</span>, <span class="boolean">true</span>, cb)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span></code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle callback functions as promises&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; fnWithCallback(<span class="keyword">new</span> Error(<span class="string">&#39;oops&#39;</span>), <span class="boolean">true</span>, cb)),</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle callback <span class="keyword">function</span> error as promise&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-hooks">run functions before and/or after individual test</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> after = () =&gt; {</code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = <span class="string">&#39;Test has finished, <span class="object">cleanup</span>.&#39;</span></code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> before = () =&gt; {</code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = <span class="boolean">false</span></code><code class="line"></code><code class="line"><span class="comment">  // <span class="keyword">if</span> a <span class="keyword">function</span> gets returned,</span></code><code class="line"><span class="comment">  // <span class="keyword">this</span> <span class="keyword">function</span> will be executed once the test <span class="object">finished</span>.</span></code><code class="line">  <span class="keyword">return</span> after</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; { <span class="object">global</span>.<span class="property">testing</span> = <span class="string">&#39;changed <span class="keyword">in</span> test&#39;</span> },</code><code class="line"><span class="comment">    // <span class="keyword">if</span> before returns a <span class="keyword">function</span>, it will execute after the <span class="object">test</span>.</span></code><code class="line">    before,</code><code class="line">    after,</code><code class="line">    <span class="colon">expect</span>: () =&gt; <span class="object">global</span>.<span class="property">testing</span> === <span class="string">&#39;changed <span class="keyword">in</span> test&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-suite-hooks">run functions before and/or after a suite of tests</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> afterAll = () =&gt; {</code><code class="line"><span class="comment">  // Test has finished, <span class="object">cleanup</span>.<span class="string">&#39;&#39;</span></span></code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = undefined</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> beforeAll = () =&gt; {</code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = <span class="boolean">false</span></code><code class="line"></code><code class="line"><span class="comment">  // <span class="keyword">if</span> a <span class="keyword">function</span> gets returned,</span></code><code class="line"><span class="comment">  // <span class="keyword">this</span> <span class="keyword">function</span> will be executed once the test suite <span class="object">finished</span>.</span></code><code class="line">  <span class="keyword">return</span> afterAll</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; { <span class="object">global</span>.<span class="property">testing</span> = <span class="string">&#39;changed <span class="keyword">in</span> test&#39;</span> },</code><code class="line"><span class="comment">    // <span class="keyword">if</span> beforeAll returns a <span class="keyword">function</span>, it will execute after the test <span class="object">suite</span>.</span></code><code class="line">    beforeAll,</code><code class="line"><span class="comment">    // <span class="keyword">this</span> is optional and can be omitted <span class="keyword">if</span> beforeall returns a <span class="keyword">function</span>.</span></code><code class="line"><span class="comment">    // <span class="keyword">in</span> <span class="keyword">this</span> example, afterAll will trigger <span class="object">twice</span>.</span></code><code class="line">    afterAll,</code><code class="line">    <span class="colon">expect</span>: () =&gt; <span class="object">global</span>.<span class="property">testing</span> === <span class="string">&#39;changed <span class="keyword">in</span> test&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h2 id="lib">Utility Belt</h2><p>@magic/test exports some utility functions that make working with complex test workflows simpler.</p><h4 id="lib-curry">curry</h4><p>Currying can be used to split the arguments of a function into multiple nested functions.</p><p>This helps if you have a function with complicated arguments that you just want to quickly shim.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { curry } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">const</span> compare = (a, b) =&gt; a === b</code><code class="line"><span class="keyword">const</span> curried = curry(compare)</code><code class="line"><span class="keyword">const</span> shimmed = curried(<span class="string">&#39;shimmed_value&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">fn</span>: shimmed(<span class="string">&#39;shimmed_value&#39;</span>),</code><code class="line">  <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">  <span class="colon">info</span>: <span class="string">&#39;expect will be called <span class="keyword">with</span> a and b and a will equal b&#39;</span>,</code><code class="line">}</code></pre></div><h4 id="lib-vals">vals</h4><p>exports some javascript types. more to come. will sometime in the future be the base of a fuzzer.</p><h3 id="lib-promises">promises</h3><p>Helper function to wrap nodejs callback functions and promises with ease.</p><p>Handles the try/catch steps internally and returns a resolved or rejected promise.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { promise, is } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">null</span>, <span class="boolean">true</span>), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promises <span class="keyword">in</span> a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">new</span> Error(<span class="string">&#39;error&#39;</span>)), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promise errors <span class="keyword">in</span> a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h4 id="lib-trycatch">tryCatch</h4><p>allows to test functions without bubbling the errors up into the runtime</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { is, tryCatch } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">const</span> throwing = () =&gt; <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&#39;oops&#39;</span>)</code><code class="line"><span class="keyword">const</span> healthy = () =&gt; <span class="boolean">true</span></code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: tryCatch(throwing()),</code><code class="line">    <span class="colon">expect</span>: <span class="object">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;<span class="keyword">function</span> <span class="keyword">throws</span> an error&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: tryCatch(healthy()),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;<span class="keyword">function</span> does not <span class="keyword">throw</span>&#39;</span></code><code class="line">  },</code><code class="line">]</code></pre></div><h2 id="usage">Usage</h2><h3 id="usage-js">js api:</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// test/<span class="object">index</span>.<span class="property">js</span></span></code><code class="line"><span class="keyword">const</span> run = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span> tests = {</code><code class="line">  <span class="colon">lib</span>: [</code><code class="line">    { <span class="colon">fn</span>: () =&gt; <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;Expect <span class="boolean">true</span> to be <span class="boolean">true</span>&#39;</span> }</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line">run(tests)</code></pre></div><h2 id="usage-cli">cli</h2><h3>package.json (recommended)</h3><p>Add the magic/test bin scripts to package.json</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">{</code><code class="line">  <span class="string">&#39;scripts&#39;</span>: {</code><code class="line">    <span class="string">&#39;test&#39;</span>: <span class="string">&#39;t -p&#39;</span>,</code><code class="line">    <span class="string">&#39;coverage&#39;</span>: <span class="string">&#39;t&#39;</span>,</code><code class="line">    <span class="string">&#39;format&#39;</span>: <span class="string">&#39;f -w&#39;</span>,</code><code class="line">    <span class="string">&#39;<span class="colon">format</span>:check&#39;</span>: <span class="string">&#39;f&#39;</span></code><code class="line">  },</code><code class="line">  <span class="string">&#39;devDependencies&#39;</span>: {</code><code class="line">    <span class="string">&#39;@magic/test&#39;</span>: <span class="string">&#39;<span class="colon">github</span>:magic/test&#39;</span></code><code class="line">  }</code><code class="line">}</code></pre></div><p>then use the npm run scripts</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm test</code><code class="line">npm run coverage</code><code class="line">npm run format</code><code class="line">npm run <span class="colon">format</span>:check</code></pre></div><h3 id="usage-global">Globally (not recommended):</h3><p>you can install this library globally but the recommendation is to add the dependency and scripts to the package.json file.</p><p>this both explains to everyone that your app has this dependencies and keeps your bash free of clutter</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm i -g magic/test</code><code class="line"></code><code class="line"><span class="comment">// run tests <span class="keyword">in</span> production mode</span></code><code class="line">t -p</code><code class="line"></code><code class="line"><span class="comment">// run tests and <span class="keyword">get</span> coverage <span class="keyword">in</span> verbose mode</span></code><code class="line">t</code><code class="line"></code><code class="line"><span class="comment">// check formatting using prettier but <span class="keyword">do</span> not write</span></code><code class="line"><span class="comment">// prettier --list-different</span></code><code class="line">f</code><code class="line"></code><code class="line"><span class="comment">// format files using prettier</span></code><code class="line"><span class="comment">// prettier --write</span></code><code class="line">f -w</code></pre></div><p>This library tests itself, have a look at <a href="https://github.com/magic/test/tree/master/test" target="_blank" rel="noopener">the tests</a></p><p>Checkout [@magic/types](https://github.com/magic/types) and the other magic libraries for more test examples.</p></div><footer class="Footer"><div class="wrapper">made with a few bits of <a target="_blank" rel="noopener" href="https://github.com/magic/core">magic</a></div></footer></div></div><script src="/test/magic.js" integrity="sha384-j18+UfPq98y+80aPZZKdCFaYL5RObxmMfxjGJ3J4VhfxP9kAwC+Y0Mw+NXp6iyu5" crossorigin="anonymous"></script></body></html>