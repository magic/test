<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="Permissions-Policy" content="interest-cohort=()"/><link rel="icon" href="/test/favicon.ico"/><title>@magic/test</title><meta name="description" content="simple tests with lots of utility. ecmascript modules only. runs ecmascript module tests without transpilation. unbelievably fast."/><script type="application/ld+json">{"@context":"http://schema.org","@type":"website","name":"@magic/test"}</script><link rel="stylesheet" href="/test/magic.css?fuYRy10jiI" integrity="sha384-fuYRy10jiIv65W7WfSmnIdUpn4j2LaceRHTeNaXLwvkt9QCfZ5jAv5cjjO3PIB1R" crossorigin="anonymous"/></head><body><a class="SkipLink" href="/test/#page">Skip to Content</a><main id="Magic"><div class="Wrapper"><header class="Header"><a class="Logo" href="/test/"><svg viewBox="0 0 512 444"><path d="M512 444L256 0 0 444z" fill="#663695"></path><circle cx="256" cy="294" r="130" fill="#fff"></circle><circle cx="256" cy="281" r="40" fill="#663695"></circle><path d="M256 350v44m24-44l1 13c1 27 29 27 29-7m-160-72s46-47 106-47c59 0 106 47 106 47s-47 43-106 43c-60 0-106-43-106-43zm65-75a134 134 0 0189 2" class="stroke"></path><path d="M256 81v53m184 270l-43-29M72 404l43-29" class="stroke white"></path></svg></a><p>@magic/test</p><nav class="Menu"><ul><li><a href="/test/#getting-started">getting started</a></li><li><a href="/test/#test-suites">test suites</a></li><li><a href="/test/#tests">writing tests</a></li><li><a href="/test/#lib">utility functions</a></li><li><a href="/test/#usage">usage</a></li></ul></nav></header><div class="Page" id="page"><h1 id="magictest">@magic/test</h1><p>simple tests with lots of utility. ecmascript modules only. runs ecmascript module syntax tests without transpilation. unbelievably fast.</p><ul class="GitBadges"><li><a href="https://www.npmjs.com/package/@magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/@magic/test?color=blue" height="23" alt="" loading="lazy"/></a></li><li><img src="https://img.shields.io/node/v/@magic/test?color=blue" height="23" alt="" loading="lazy"/></li><li><img src="https://img.shields.io/npm/l/@magic/test?color=blue" height="23" alt="" loading="lazy"/></li><li><a href="https://travis-ci.com/magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/travis/com/magic/test/master" height="23" alt="" loading="lazy"/></a></li><li><a href="https://ci.appveyor.com/project/magic/test/branch/master" target="_blank" rel="noopener"><img src="https://img.shields.io/appveyor/ci/magic/test/master.svg" height="23" alt="" loading="lazy"/></a></li><li><a href="https://coveralls.io/github/magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/coveralls/github/magic/test/master.svg" height="23" alt="" loading="lazy"/></a></li><li><a href="https://snyk.io/test/github/magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/snyk/vulnerabilities/github/magic/test.svg" height="23" alt="" loading="lazy"/></a></li></ul><h2 id="getting-started">getting started</h2><p>be in a nodejs project.</p><h3 id="getting-started-install">install</h3><div class="Pre"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">npm</span> i --save-dev --save-exact @magic/test</code></pre></div><h3>Create a test</h3><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="comment">// create test/functionName.mjs</span></code><code class="line"><span class="keyword">import</span> yourTest from <span class="string">&#39;../path/to/your/file.mjs&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  { fn: () <span class="keyword">=&gt;</span> true, expect: true, info: <span class="string">&#39;true is true&#39;</span> },</code><code class="line">  <span class="comment">// note that the yourTest <span class="keyword">function</span> will be called automagically</span></code><code class="line">  { fn: yourTest, expect: true, info: <span class="string">&#39;hope this will work ;)&#39;</span>}</code><code class="line">]</code></pre></div><h3 id="getting-started-npm-scripts">npm scripts</h3><p>edit package.json</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">{</code><code class="line">  <span class="string">&quot;scripts&quot;</span>: {</code><code class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;t -p&quot;</span>, <span class="comment">// quick test, only failing tests log</span></code><code class="line">    <span class="string">&quot;coverage&quot;</span>: <span class="string">&quot;t&quot;</span>, <span class="comment">// <span class="keyword">get</span> full test output and coverage reports</span></code><code class="line">  }</code><code class="line">}</code></pre></div><p>repeated for easy copy pasting (without comments and trailing commas)</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="string">&quot;scripts&quot;</span>: {</code><code class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;t -p&quot;</span>,</code><code class="line">    <span class="string">&quot;coverage&quot;</span>: <span class="string">&quot;t&quot;</span></code><code class="line">  }</code></pre></div><h3 id="getting-started-quick-tests">quick tests</h3><p>without coverage</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="comment">// run the tests:</span></code><code class="line"><span class="keyword">npm</span> test</code><code class="line"></code><code class="line"><span class="comment">// example output:</span></code><code class="line"><span class="comment">// (failing tests will print, passing tests are silent)</span></code><code class="line"></code><code class="line"><span class="comment">// ### Testing package: @magic/test</span></code><code class="line"><span class="comment">// Ran 2 tests. Passed 2/2 100%</span></code></pre></div><h3 id="getting-started-coverage">coverage</h3><p>@magic/test will automagically generate coverage reports if it is not called with the -p flag.</p><h3 id="test-suites">data/fs driven test suite creation:</h3><h4 id="expectations-for-optimal-test-messages">expectations for optimal test messages:</h4><ul><li>src and test directories have the same directory structure and filenames</li><li>tests one src file per test file</li><li>tests one function per test suite</li><li>tests one feature per test unit</li></ul><h4 id="test-suites-fs">Filesystem based naming</h4><p>the following directory structure:</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">./test/</code><code class="line">  ./suite1.mjs</code><code class="line">  ./suite2.mjs</code></pre></div><p>yields the same result as exporting the following from ./test/index.mjs</p><h4 id="test-suites-data">Data driven naming</h4><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> suite1 from <span class="string">&#39;./suite1&#39;</span></code><code class="line"><span class="keyword">import</span> suite2 from <span class="string">&#39;./suite2&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line">  suite1,</code><code class="line">  suite2,</code><code class="line">}</code></pre></div><h3 id="important---file-mappings">Important - File mappings</h3><p>if test/index.mjs exists, no other files will be loaded. if test/index.mjs exists, no other files from that directory will be loaded, if test/lib/index.mjs, no other files from that subdirectory will be loaded. instead the exports of those index.mjs will be expected to be tests</p><h3 id="tests">single test</h3><p>literal value, function or promise</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: true, expect: true, info: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// expect: <span class="boolean">true</span> is the <span class="keyword">default</span> and can be omitted</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: true, info: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> fn is a <span class="keyword">function</span> expect is the returned value of the <span class="keyword">function</span></span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: () <span class="keyword">=&gt;</span> false, expect: false, info: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> expect is a <span class="keyword">function</span> the <span class="keyword">return</span> value of the test <span class="keyword">get</span> passed to it</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: false, expect: t <span class="keyword">=&gt;</span> t === false, info: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> fn is a promise the resolved value will be returned</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: <span class="keyword">new</span> Promise(r <span class="keyword">=&gt;</span> r(true)), expect: true, info: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">if</span> expects is a promise it will resolve before being compared to the fn <span class="keyword">return</span> value</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: true, expect: <span class="keyword">new</span> Promise(r <span class="keyword">=&gt;</span> r(true)), info: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><span class="comment">// callback functions can be tested easily too:</span></code><code class="line"><span class="keyword">import</span> { promise } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> fnWithCallback = (err, arg, cb) <span class="keyword">=&gt;</span> cb(err, arg)</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> { fn: promise(fnWithCallback(null, <span class="string">&#39;arg&#39;</span>, (e, a) <span class="keyword">=&gt;</span> a)), expect: <span class="string">&quot;arg&quot;</span> }</code></pre></div><h4 id="tests-types">testing types</h4><p>types can be compared using <a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a></p><p>@magic/types is a richly featured and thoroughly tested type library without dependencies. it is exported from this library for convenience.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { is } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  { fn: () <span class="keyword">=&gt;</span> <span class="string">&#39;string&#39;</span>,</code><code class="line">    expect: is.string,</code><code class="line">    info: <span class="string">&#39;test if a function returns a string&#39;</span></code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> <span class="string">&#39;string&#39;</span>,</code><code class="line">    expect: is.length.equal(6),</code><code class="line">    info: <span class="string">&#39;test length of returned value&#39;</span></code><code class="line">  },</code><code class="line">  <span class="comment">// !!! Testing <span class="keyword">for</span> deep equality. simple.</span></code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> [1, 2, 3],</code><code class="line">    expect: is.deep.equal([1, 2, 3]),</code><code class="line">    info: <span class="string">&#39;deep compare arrays/objects for equality&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> { key: 1 },</code><code class="line">    expect: is.deep.different({ value: 1 }),</code><code class="line">    info: <span class="string">&#39;deep compare arrays/objects for difference&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h4 id="caveat">caveat:</h4><p>if you want to test if a function is a function, you need to wrap the function in a function. this is because functions passed to fn get executed automatically.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { is } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> fnToTest = () <span class="keyword">=&gt;</span> {}</code><code class="line"></code><code class="line"><span class="comment">// both the tests will work as expected</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> fnToTest,</code><code class="line">    expect: is.function,</code><code class="line">    info: <span class="string">&#39;function is a function&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: is.fn(fnToTest), <span class="comment">// returns <span class="boolean">true</span></span></code><code class="line">    <span class="comment">// we <span class="keyword">do</span> not set expect: true, since that is the <span class="keyword">default</span></span></code><code class="line">    <span class="comment">// expect: true,</span></code><code class="line">    info: <span class="string">&#39;function is a function&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="comment">// will not work as expected and instead call fnToTest</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line">  fn: fnToTest,</code><code class="line">  expect: is.function,</code><code class="line">  info: <span class="string">&#39;function is a function&#39;</span>,</code><code class="line">}</code></pre></div><h3 id="tests-multiple">multiple tests</h3><p>multiple tests can be created by exporting an array of single test objects.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line">  multipleTests: [</code><code class="line">    { fn: () <span class="keyword">=&gt;</span> true, expect: true, info: <span class="string">&#39;expect true to be true&#39;</span> },</code><code class="line">    { fn: () <span class="keyword">=&gt;</span> false, expect: false, info: <span class="string">&#39;expect false to be false&#39;</span> },</code><code class="line">  ]</code><code class="line">}</code></pre></div><p>multiple tests can also be created by exporting an array of tests.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  { fn: () <span class="keyword">=&gt;</span> true, expect: true, info: <span class="string">&#39;expect true to be true&#39;</span> },</code><code class="line">  { fn: () <span class="keyword">=&gt;</span> false, expect: false, info: <span class="string">&#39;expect false to be false&#39;</span> },</code><code class="line">]</code></pre></div><h3 id="tests-promises">promises</h3><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { promise, is } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  <span class="comment">// kinda clumsy, but works. until you <span class="keyword">try</span> handling errors.</span></code><code class="line">  {</code><code class="line">    fn: <span class="keyword">new</span> Promise(cb <span class="keyword">=&gt;</span> setTimeOut(() <span class="keyword">=&gt;</span> cb(true), 2000)),</code><code class="line">    expect: true,</code><code class="line">    info: <span class="string">&#39;handle promises&#39;</span>,</code><code class="line">  },</code><code class="line">  <span class="comment">// better!</span></code><code class="line">  {</code><code class="line">    fn: promise(cb <span class="keyword">=&gt;</span> setTimeOut(() <span class="keyword">=&gt;</span> cb(null, true), 200)),</code><code class="line">    expect: true,</code><code class="line">    info: <span class="string">&#39;handle promises in a nicer way&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: promise(cb <span class="keyword">=&gt;</span> setTimeOut(() <span class="keyword">=&gt;</span> cb(new Error(<span class="string">&#39;error&#39;</span>)), 200)),</code><code class="line">    expect: is.error,</code><code class="line">    info: <span class="string">&#39;handle promise errors in a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-cb">callback functions</h3><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { promise, is } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> fnWithCallback = (err, arg, cb) <span class="keyword">=&gt;</span> cb(err, arg)</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  {</code><code class="line">    fn: promise(cb <span class="keyword">=&gt;</span> fnWithCallback(null, true, cb)),</code><code class="line">    expect: <span class="boolean">true</span></code><code class="line">    info: <span class="string">&#39;handle callback functions as promises&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: promise(cb <span class="keyword">=&gt;</span> fnWithCallback(new Error(<span class="string">&#39;oops&#39;</span>), true, cb)),</code><code class="line">    expect: is.error,</code><code class="line">    info: <span class="string">&#39;handle callback function error as promise&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-hooks">hooks</h3><p>run functions before and/or after individual test</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> after = () <span class="keyword">=&gt;</span> {</code><code class="line">  global.testing = <span class="string">&#39;Test has finished, cleanup.&#39;</span></code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> before = () <span class="keyword">=&gt;</span> {</code><code class="line">  global.testing = <span class="boolean">false</span></code><code class="line"></code><code class="line">  <span class="comment">// <span class="keyword">if</span> a <span class="keyword">function</span> gets returned,</span></code><code class="line">  <span class="comment">// <span class="keyword">this</span> <span class="keyword">function</span> will be executed once the test finished.</span></code><code class="line">  <span class="keyword">return</span> after</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> { global.testing = <span class="string">&#39;changed in test&#39;</span> },</code><code class="line">    <span class="comment">// <span class="keyword">if</span> before returns a function, it will execute after the test.</span></code><code class="line">    before,</code><code class="line">    after,</code><code class="line">    expect: () <span class="keyword">=&gt;</span> global.testing === <span class="string">&#39;changed in test&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-suite-hooks">suite hooks</h3><p>run functions before and/or after a suite of tests</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> afterAll = () <span class="keyword">=&gt;</span> {</code><code class="line">  <span class="comment">// Test has finished, cleanup.&#39;</span></code><code class="line">  global.testing = undefined</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> beforeAll = () <span class="keyword">=&gt;</span> {</code><code class="line">  global.testing = <span class="boolean">false</span></code><code class="line"></code><code class="line">  <span class="comment">// <span class="keyword">if</span> a <span class="keyword">function</span> gets returned,</span></code><code class="line">  <span class="comment">// <span class="keyword">this</span> <span class="keyword">function</span> will be executed once the test suite finished.</span></code><code class="line">  <span class="keyword">return</span> afterAll</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> { global.testing = <span class="string">&#39;changed in test&#39;</span> },</code><code class="line">    <span class="comment">// <span class="keyword">if</span> beforeAll returns a function, it will execute after the test suite.</span></code><code class="line">    beforeAll,</code><code class="line">    <span class="comment">// <span class="keyword">this</span> is optional and can be omitted <span class="keyword">if</span> beforeall returns a function.</span></code><code class="line">    <span class="comment">// <span class="keyword">in</span> <span class="keyword">this</span> example, afterAll will trigger twice.</span></code><code class="line">    afterAll,</code><code class="line">    expect: () <span class="keyword">=&gt;</span> global.testing === <span class="string">&#39;changed in test&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-magic-modules">magic modules</h3><p>@magic-modules assume all html tags to be globally defined. to create those globals for your test and check if a @magic-module returns the correct markup, just add an html: true flag to the test.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> expect = [</code><code class="line">  <span class="string">&#39;i&#39;</span>,</code><code class="line">  [</code><code class="line">    { class: <span class="string">&#39;testing&#39;</span> },</code><code class="line">    <span class="string">&#39;testing&#39;</span>,</code><code class="line">  ],</code><code class="line">]</code><code class="line"></code><code class="line"><span class="keyword">const</span> props = { class: <span class="string">&#39;testing&#39;</span> }</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  <span class="comment">// note that fn is a wrapped function, we can not call i directly as we could other functions</span></code><code class="line">  {</code><code class="line">    fn: () <span class="keyword">=&gt;</span> i(props, <span class="string">&#39;testing&#39;</span>),</code><code class="line">    expect,</code><code class="line">    info: <span class="string">&#39;magic/test can now test html&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h2 id="lib">Utility Belt</h2><p>@magic/test exports some utility functions that make working with complex test workflows simpler.</p><h4 id="lib-curry">curry</h4><p>Currying can be used to split the arguments of a function into multiple nested functions. This helps if you have a function with complicated arguments that you just want to quickly shim.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { curry } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> compare = (a, b) <span class="keyword">=&gt;</span> a === b</code><code class="line"><span class="keyword">const</span> curried = curry(compare)</code><code class="line"><span class="keyword">const</span> shimmed = curried(<span class="string">&#39;shimmed_value&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line">  fn: shimmed(<span class="string">&#39;shimmed_value&#39;</span>),</code><code class="line">  expect: true,</code><code class="line">  info: <span class="string">&#39;expect will be called with a and b and a will equal b&#39;</span>,</code><code class="line">}</code></pre></div><h4 id="lib-vals">vals</h4><p>exports some javascript types. more to come. will sometime in the future be the base of a fuzzer.</p><h3 id="lib-promises">promises</h3><p>Helper function to wrap nodejs callback functions and promises with ease. Handle the try/catch steps internally and return a resolved or rejected promise.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { promise, is } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  {</code><code class="line">    fn: promise(cb <span class="keyword">=&gt;</span> setTimeOut(() <span class="keyword">=&gt;</span> cb(null, true), 200)),</code><code class="line">    expect: true,</code><code class="line">    info: <span class="string">&#39;handle promises in a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: promise(cb <span class="keyword">=&gt;</span> setTimeOut(() <span class="keyword">=&gt;</span> cb(new Error(<span class="string">&#39;error&#39;</span>)), 200)),</code><code class="line">    expect: is.error,</code><code class="line">    info: <span class="string">&#39;handle promise errors in a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="lib-css">css</h3><p>exports <a href="https://github.com/magic/css" target="_blank" rel="noopener">@magic/css</a>, which allows parsing and stringification of css-in-js objects.</p><h4 id="lib-trycatch">trycatch</h4><p>allows to test functions without bubbling the errors up into the runtime</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> { is, tryCatch } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> throwing = () <span class="keyword">=&gt;</span> <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&#39;oops&#39;</span>)</code><code class="line"><span class="keyword">const</span> healthy = () <span class="keyword">=&gt;</span> <span class="boolean">true</span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</code><code class="line">  {</code><code class="line">    fn: tryCatch(throwing()),</code><code class="line">    expect: is.error,</code><code class="line">    info: <span class="string">&#39;function throws an error&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    fn: tryCatch(healthy()),</code><code class="line">    expect: true,</code><code class="line">    info: <span class="string">&#39;function does not throw&#39;</span></code><code class="line">  },</code><code class="line">]</code></pre></div><h4 id="lib-version">version</h4><p>The version plugin checks your code according to a spec defined by you. This is designed to warn you on changes to your exports.</p><p>Internally, the version function calls <a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a> and all functions exported from it are valid type strings in version specs.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="comment">// test/spec.js</span></code><code class="line"><span class="keyword">import</span> { version } from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="comment">// <span class="keyword">import</span> your lib as your codebase requires</span></code><code class="line"><span class="comment">// <span class="keyword">import</span> * as lib from &#39;../src/index.js&#39;</span></code><code class="line"><span class="comment">// <span class="keyword">import</span> lib from &#39;../src/index.js</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> spec = {</code><code class="line">  stringValue: <span class="string">&#39;string&#39;</span>,</code><code class="line">  numberValue: <span class="string">&#39;number&#39;</span>,</code><code class="line"></code><code class="line">  objectValue: [</code><code class="line">    <span class="string">&#39;obj&#39;</span>,</code><code class="line">    {</code><code class="line">      key: <span class="string">&#39;Willbechecked&#39;</span>,</code><code class="line">    },</code><code class="line">  ],</code><code class="line"></code><code class="line">  objectNoChildCheck: [</code><code class="line">    <span class="string">&#39;obj&#39;</span>,</code><code class="line">    false,</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> version(lib, spec)</code></pre></div><h2 id="usage">usage</h2><h3 id="usage-js">js</h3><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="comment">// test/index.mjs</span></code><code class="line"><span class="keyword">import</span> run from <span class="string">&#39;@magic/test&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> tests = {</code><code class="line">  lib: [</code><code class="line">    { fn: () <span class="keyword">=&gt;</span> true, expect: true, info: <span class="string">&#39;Expect true to be true&#39;</span> }</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line">run(tests)</code></pre></div><h2 id="usage-cli">cli</h2><h3 id="packagejson-recommended">package.json (recommended)</h3><p>add the magic/test bin scripts to package.json</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">{</code><code class="line">  <span class="string">&quot;scripts&quot;</span>: {</code><code class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;t -p&quot;</span>,</code><code class="line">    <span class="string">&quot;coverage&quot;</span>: <span class="string">&quot;t&quot;</span>,</code><code class="line">  },</code><code class="line">  <span class="string">&quot;devDependencies&quot;</span>: {</code><code class="line">    <span class="string">&quot;@magic/test&quot;</span>: <span class="string">&quot;github:magic/test&quot;</span></code><code class="line">  }</code><code class="line">}</code></pre></div><p>then use the npm run scripts</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">npm</span> test</code><code class="line"><span class="keyword">npm</span> run coverage</code></pre></div><h3 id="usage-global">Globally (not recommended):</h3><p>you can install this library globally, but the recommendation is to add the dependency and scripts to the package.json file.</p><p>this both explains to everyone that your app has these dependencies as well as keeping your bash free of clutter</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">npm</span> i -g @magic/test</code><code class="line"></code><code class="line"><span class="comment">// run tests <span class="keyword">in</span> production mode</span></code><code class="line">t -p</code><code class="line"></code><code class="line"><span class="comment">// run tests and <span class="keyword">get</span> coverage <span class="keyword">in</span> verbose mode</span></code><code class="line">t</code></pre></div><p>This library tests itself, have a look at <a href="https://github.com/magic/test/tree/master/test" target="_blank" rel="noopener">the tests</a> Checkout <a href="https://github.com/magic/types/tree/master/test" target="_blank" rel="noopener">@magic/types</a> and the other magic libraries for more test examples.</p></div><footer class="Footer"><div class="Container"><div class="Credits">made with a few bits of <a target="_blank" rel="noopener" href="https://magic.github.io/">magic</a></div></div></footer></div></main><script src="/test/magic.js?YP2FxlKg2H" integrity="sha384-YP2FxlKg2H49Z+b6OzwMGvSP03X24WeZ/8UxLB+W+cD7EcNbeob+InO+EXF3IKOi" crossorigin="anonymous" type="module"></script></body></html>