<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/test/favicon.ico"/><link rel="stylesheet" href="/test/magic.css"/></head><body><div id="magic"><div class="wrapper"><header class="main"><a class="logo-wrapper" href="/test/"><span class="logo-text">@magic/test</span></a><nav class="Menu "><ul><li><a href="/test/#dependencies">dependencies</a></li><li><a href="/test/#getting-started">getting started</a></li><li><a href="/test/#test-suites">test suites</a></li><li><a href="/test/#tests">writing tests</a></li><li><a href="/test/#lib">utility functions</a></li><li><a href="/test/#usage">Cli / Js Api Usage</a></li></ul></nav></header><div class="page"><h1>@magic/test</h1><p>simple tests with lots of utility.</p><ul class="GitBadges"><li><a href="https://www.npmjs.com/package/@magic/test" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/@magic/test.svg" role="presentation" alt=""/></a></li><li><a href="https://travis-ci.com/magic/test" target="_blank" rel="noopener"><img src="https://travis-ci.com/magic/test.svg?branch=master" role="presentation" alt=""/></a></li><li><a href="https://ci.appveyor.com/project/jaeh/test/branch/master" target="_blank" rel="noopener"><img src="https://img.shields.io/appveyor/ci/jaeh/test/master.svg" role="presentation" alt=""/></a></li><li><a href="https://coveralls.io/github/magic/test" target="_blank" rel="noopener"><img src="https://coveralls.io/repos/github/magic/test/badge.svg" role="presentation" alt=""/></a></li><li><a href="https://greenkeeper.io" target="_blank" rel="noopener"><img src="https://badges.greenkeeper.io/magic/test.svg" role="presentation" alt=""/></a></li><li><a href="https://snyk.io/test/github/magic/test" target="_blank" rel="noopener"><img src="https://snyk.io/test/github/magic/test/badge.svg" role="presentation" alt=""/></a></li></ul><h2 id="dependencies">dependencies</h2><p><a href="https://github.com/magic/log" target="_blank" rel="noopener">@magic/log</a>: console.log wrapper with loglevels</p><p><a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a>: type checking library</p><p><a href="https://github.com/magic/deep" target="_blank" rel="noopener">@magic/deep</a>: deeply compare and manipulate arrays and objects</p><p><a href="https://www.npmjs.com/package/nyc" target="_blank" rel="noopener">nyc</a>: code coverage</p><p><a href="https://www.npmjs.com/package/prettier" target="_blank" rel="noopener">prettier</a>: code formatting</p><p>@magic/log and @magic/types have no dependencies.</p><h2 id="getting-started">Getting started</h2><p>be in a nodejs project.</p><h3 id="install">install</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm<span class="keyword"> </span><span class="keyword">i</span> --save-dev @magic/test</code></pre></div><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// create test/functionName.js</code></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>yourTest = <span class="keyword">require</span>(<span class="string">&#39;../path/to/your/file.js&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  { <span class="colon">fn</span>: () =&gt; <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;true is true&#39;</span> },</code><code class="line"><code class="line comment">  // note that the function will be called automagically</code></code><code class="line">  { <span class="colon">fn</span>: yourTest, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;hope this will work ;)&#39;</span>}</code><code class="line">]</code></pre></div><h3 id="npm-scripts">npm run scripts</h3><p>edit package.json</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">{</code><code class="line">  <span class="string">&#39;scripts&#39;</span>: {</code><code class="line"><code class="line">    <span class="string">&#39;test&#39;</span>: <span class="string">&#39;t -p&#39;</span>, <code class="comment">// quick test, only failing tests log</code></code></code><code class="line"><code class="line">    <span class="string">&#39;coverage&#39;</span>: <span class="string">&#39;t&#39;</span>, <code class="comment">// get full test output and coverage reports</code></code></code><code class="line"><code class="line">    <span class="string">&#39;format&#39;</span>: <span class="string">&#39;f -w&#39;</span>, <code class="comment">// format using prettier and write changes to files</code></code></code><code class="line"><code class="line">    <span class="string">&#39;format:check&#39;</span>: <span class="string">&#39;f&#39;</span><span class="keyword"> </span><code class="comment">// check format using prettier</code></code></code><code class="line">  }</code><code class="line">}</code></pre></div><p>repeated for easy copy pasting (without comments)</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">  <span class="string">&#39;scripts&#39;</span>: {</code><code class="line">    <span class="string">&#39;test&#39;</span>: <span class="string">&#39;t -p&#39;</span>,</code><code class="line">    <span class="string">&#39;coverage&#39;</span>: <span class="string">&#39;t&#39;</span>,</code><code class="line">    <span class="string">&#39;format&#39;</span>: <span class="string">&#39;f -w&#39;</span>,</code><code class="line">    <span class="string">&#39;format:check&#39;</span>: <span class="string">&#39;f&#39;</span></code><code class="line">  }</code></pre></div><h3 id="quick-tests">quick tests (without coverage)</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// run the tests:</code></code><code class="line">npm<span class="keyword"> </span>test</code><code class="line"></code><code class="line"><code class="line comment">// example output:</code></code><code class="line"><code class="line comment">// (failing tests will print, passing tests are silent)</code></code><code class="line"></code><code class="line"><code class="line comment">// ### Testing package: @magic/test</code></code><code class="line"><code class="line comment">// Ran 2 tests. Passed 2/2 100%</code></code></pre></div><h3 id="coverage">coverage</h3><p>run coverage reports and get full test report including from passing tests</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm<span class="keyword"> </span>run<span class="keyword"> </span>coverage</code></pre></div><h3 id="test-suites">data/fs driven test suite creation:</h3><h4>expectations for optimal test messages:</h4><p>src and test directories have the same structure and files</p><p>tests one src file per test file</p><p>tests one function per suite</p><p>tests one feature per test</p><h4 id="test-suites-fs">Filesystem based naming</h4><p>the following directory structure:</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">./test/</code><code class="line">  ./<span class="object">suite1</span>.<span class="property">js</span></code><code class="line">  ./<span class="object">suite2</span>.<span class="property">js</span></code></pre></div><p>yields the same result as exporting the following from ./test/index.js</p><h4 id="test-suites-data">Data driven naming</h4><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>suite1 = <span class="keyword">require</span>(<span class="string">&#39;./suite1&#39;</span>)</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>suite2 = <span class="keyword">require</span>(<span class="string">&#39;./suite2&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  suite1,</code><code class="line">  suite2,</code><code class="line">}</code></pre></div><h3>Important - File mappings</h3><p>if test/index.js exists, no other files will be loaded.</p><p>if test/lib/index.js exists, no other files from that subdirectory will be loaded.</p><h3 id="tests">single test, literal value, function or promise</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><code class="line comment">// expect: true is the default and can be omitted</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><code class="line comment">// if fn is a function expect is the returned value of the function</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: () =&gt; <span class="boolean">false</span>, <span class="colon">expect</span>: <span class="boolean">false</span>, <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><code class="line comment">// if expect is a function the return value of the test get passed to it</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">false</span>, <span class="colon">expect</span>: <span class="keyword">t</span> =&gt; <span class="keyword">t</span> === <span class="boolean">false</span>, <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><code class="line comment">// if fn is a promise the resolved value will be returned</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="keyword">new</span><span class="keyword"> </span><span class="builtin">Promise</span>(<span class="keyword">r</span> =&gt; <span class="keyword">r</span>(<span class="boolean">true</span>)), <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><code class="line comment">// if expects is a promise it will resolve before being compared to the fn return value</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="keyword">new</span><span class="keyword"> </span><span class="builtin">Promise</span>(<span class="keyword">r</span> =&gt; <span class="keyword">r</span>(<span class="boolean">true</span>)), <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> }</code><code class="line"></code><code class="line"><code class="line comment">// callback functions can be tested easily too:</code></code><code class="line"><span class="keyword">const</span> { promise } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>fnWithCallback = (err, arg, cb) =&gt; cb(err, arg)</code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = { <span class="colon">fn</span>: promise(fnWithCallback(<span class="keyword">null</span>, <span class="string">&#39;arg&#39;</span>, (<span class="keyword">e</span>, <span class="keyword">a</span>) =&gt; <span class="keyword">a</span>)), <span class="colon">expect</span>: <span class="string">&#39;arg&#39;</span> }</code></pre></div><h4 id="tests-types">testing types</h4><p>types can be compared using <a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a></p><p>@magic/types is a richly featured and thoroughly tested type library without dependencies. it is exported from this library for convenience.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { <span class="keyword">is</span> } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  { <span class="colon">fn</span>: () =&gt; <span class="string">&#39;string&#39;</span>,</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">string</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;test if a function returns a string&#39;</span></code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; <span class="string">&#39;string&#39;</span>,</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">length</span>.<span class="property">equal</span>(<span class="builtin">6</span>),</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;test length of returned value&#39;</span></code><code class="line">  },</code><code class="line"><code class="line comment">  // !!! Testing for deep equality. simple.</code></code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; [<span class="builtin">1</span>, <span class="builtin">2</span>, <span class="builtin">3</span>],</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">deep</span>.<span class="property">equal</span>([<span class="builtin">1</span>, <span class="builtin">2</span>, <span class="builtin">3</span>]),</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;deep compare arrays/objects for equality&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; { <span class="colon">key</span>: <span class="builtin">1</span> },</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">deep</span>.<span class="property">different</span>({ <span class="colon">value</span>: <span class="builtin">1</span> }),</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;deep compare arrays/objects for difference&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h4>caveat:</h4><p>if you want to test if a function is a function, you need to wrap the function</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { <span class="keyword">is</span> } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>fnToTest = () =&gt; {}</code><code class="line"><code class="line comment">// both the tests will work as expected</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; fnToTest,</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="keyword">function</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;function is a function&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line"><code class="line">    <span class="colon">fn</span>: <span class="keyword">is</span>.<span class="property">fn</span>(fnToTest), <code class="comment">// returns true</code></code></code><code class="line"><code class="line comment">    // we do not set expect: true, since that is the default</code></code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;function is a function&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// will not work as expected and instead call fnToTest</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">fn</span>: fnToTest,</code><code class="line">  <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="keyword">function</span>,</code><code class="line">  <span class="colon">info</span>: <span class="string">&#39;function is a function&#39;</span>,</code><code class="line">}</code></pre></div><h3 id="tests-multiple"> multiple tests</h3><p>multiple tests can be created by exporting an array of single test objects.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">multipleTests</span>: [</code><code class="line">    { <span class="colon">fn</span>: () =&gt; <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;expect true to be true&#39;</span> },</code><code class="line">    { <span class="colon">fn</span>: () =&gt; <span class="boolean">false</span>, <span class="colon">expect</span>: <span class="boolean">false</span>, <span class="colon">info</span>: <span class="string">&#39;expect false to be false&#39;</span> },</code><code class="line">  ]</code><code class="line">}</code></pre></div><h3 id="tests-promises">promises</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { promise, <span class="keyword">is</span> } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line"><code class="line comment">  // kinda clumsy, but works. until you try handling errors.</code></code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: <span class="keyword">new</span><span class="keyword"> </span><span class="builtin">Promise</span>(cb =&gt; setTimeOut(() =&gt; cb(<span class="boolean">true</span>), 2000)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promises&#39;</span>,</code><code class="line">  },</code><code class="line"><code class="line comment">  // better!</code></code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">null</span>, <span class="boolean">true</span>), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promises in a nicer way&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">new</span><span class="keyword"> </span>Error(<span class="string">&#39;error&#39;</span>)), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promise errors in a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-cb">callback functions</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { promise, <span class="keyword">is</span> } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>fnWithCallback = (err, arg, cb) =&gt; cb(err, arg)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; fnWithCallback(<span class="keyword">null</span>, <span class="boolean">true</span>, cb)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span></code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle callback functions as promises&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; fnWithCallback(<span class="keyword">new</span><span class="keyword"> </span>Error(<span class="string">&#39;oops&#39;</span>), <span class="boolean">true</span>, cb)),</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle callback function error as promise&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-hooks">run functions before and/or after individual test</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>after = () =&gt; {</code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = <span class="string">&#39;Test has finished, cleanup.&#39;</span></code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>before = () =&gt; {</code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = <span class="boolean">false</span></code><code class="line"></code><code class="line"><code class="line comment">  // if a function gets returned,</code></code><code class="line"><code class="line comment">  // this function will be executed once the test finished.</code></code><code class="line">  <span class="keyword">return</span><span class="keyword"> </span>after</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; { <span class="object">global</span>.<span class="property">testing</span> = <span class="string">&#39;changed in test&#39;</span> },</code><code class="line"><code class="line comment">    // if before returns a function, it will execute after the test.</code></code><code class="line">    before,</code><code class="line">    after,</code><code class="line">    <span class="colon">expect</span>: () =&gt; <span class="object">global</span>.<span class="property">testing</span> === <span class="string">&#39;changed in test&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h3 id="tests-suite-hooks">run functions before and/or after a suite of tests</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>afterAll = () =&gt; {</code><code class="line"><code class="line comment">  // Test has finished, cleanup.&#39;</code></code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = undefined</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>beforeAll = () =&gt; {</code><code class="line">  <span class="object">global</span>.<span class="property">testing</span> = <span class="boolean">false</span></code><code class="line"></code><code class="line"><code class="line comment">  // if a function gets returned,</code></code><code class="line"><code class="line comment">  // this function will be executed once the test suite finished.</code></code><code class="line">  <span class="keyword">return</span><span class="keyword"> </span>afterAll</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: () =&gt; { <span class="object">global</span>.<span class="property">testing</span> = <span class="string">&#39;changed in test&#39;</span> },</code><code class="line"><code class="line comment">    // if beforeAll returns a function, it will execute after the test suite.</code></code><code class="line">    beforeAll,</code><code class="line"><code class="line comment">    // this is optional and can be omitted if beforeall returns a function.</code></code><code class="line"><code class="line comment">    // in this example, afterAll will trigger twice.</code></code><code class="line">    afterAll,</code><code class="line">    <span class="colon">expect</span>: () =&gt; <span class="object">global</span>.<span class="property">testing</span> === <span class="string">&#39;changed in test&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h2 id="lib">Utility Belt</h2><p>@magic/test exports some utility functions that make working with complex test workflows simpler.</p><h4 id="lib-curry">curry</h4><p>Currying can be used to split the arguments of a function into multiple nested functions.</p><p>This helps if you have a function with complicated arguments that you just want to quickly shim.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { curry } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>compare = (<span class="keyword">a</span>, <span class="keyword">b</span>) =&gt; <span class="keyword">a</span> === <span class="keyword">b</span></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>curried = curry(compare)</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>shimmed = curried(<span class="string">&#39;shimmed_value&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">fn</span>: shimmed(<span class="string">&#39;shimmed_value&#39;</span>),</code><code class="line">  <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">  <span class="colon">info</span>: <span class="string">&#39;expect will be called with a and b and a will equal b&#39;</span>,</code><code class="line">}</code></pre></div><h4 id="lib-vals">vals</h4><p>exports some javascript types. more to come. will sometime in the future be the base of a fuzzer.</p><h3 id="lib-promises">promises</h3><p>Helper function to wrap nodejs callback functions and promises with ease.</p><p>Handles the try/catch steps internally and returns a resolved or rejected promise.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { promise, <span class="keyword">is</span> } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">null</span>, <span class="boolean">true</span>), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promises in a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: promise(cb =&gt; setTimeOut(() =&gt; cb(<span class="keyword">new</span><span class="keyword"> </span>Error(<span class="string">&#39;error&#39;</span>)), 200)),</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;handle promise errors in a nice way&#39;</span>,</code><code class="line">  },</code><code class="line">]</code></pre></div><h4 id="lib-trycatch">tryCatch</h4><p>allows to test functions without bubbling the errors up into the runtime</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> { <span class="keyword">is</span>, tryCatch } = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>throwing = () =&gt; <span class="keyword">throw</span><span class="keyword"> </span><span class="keyword">new</span><span class="keyword"> </span>Error(<span class="string">&#39;oops&#39;</span>)</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>healthy = () =&gt; <span class="boolean">true</span></code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = [</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: tryCatch(throwing()),</code><code class="line">    <span class="colon">expect</span>: <span class="keyword">is</span>.<span class="property">error</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;function throws an error&#39;</span>,</code><code class="line">  },</code><code class="line">  {</code><code class="line">    <span class="colon">fn</span>: tryCatch(healthy()),</code><code class="line">    <span class="colon">expect</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">info</span>: <span class="string">&#39;function does not throw&#39;</span></code><code class="line">  },</code><code class="line">]</code></pre></div><h2 id="usage">Usage</h2><h3 id="usage-js">js api:</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// test/index.js</code></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>run = <span class="keyword">require</span>(<span class="string">&#39;@magic/test&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>tests = {</code><code class="line">  <span class="colon">lib</span>: [</code><code class="line">    { <span class="colon">fn</span>: () =&gt; <span class="boolean">true</span>, <span class="colon">expect</span>: <span class="boolean">true</span>, <span class="colon">info</span>: <span class="string">&#39;Expect true to be true&#39;</span> }</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line">run(tests)</code></pre></div><h2 id="usage-cli">cli</h2><h3>package.json (recommended)</h3><p>Add the magic/test bin scripts to package.json</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">{</code><code class="line">  <span class="string">&#39;scripts&#39;</span>: {</code><code class="line">    <span class="string">&#39;test&#39;</span>: <span class="string">&#39;t -p&#39;</span>,</code><code class="line">    <span class="string">&#39;coverage&#39;</span>: <span class="string">&#39;t&#39;</span>,</code><code class="line">    <span class="string">&#39;format&#39;</span>: <span class="string">&#39;f -w&#39;</span>,</code><code class="line">    <span class="string">&#39;format:check&#39;</span>: <span class="string">&#39;f&#39;</span></code><code class="line">  },</code><code class="line">  <span class="string">&#39;devDependencies&#39;</span>: {</code><code class="line">    <span class="string">&#39;@magic/test&#39;</span>: <span class="string">&#39;github:magic/test&#39;</span></code><code class="line">  }</code><code class="line">}</code></pre></div><p>then use the npm run scripts</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm<span class="keyword"> </span>test</code><code class="line">npm<span class="keyword"> </span>run<span class="keyword"> </span>coverage</code><code class="line">npm<span class="keyword"> </span>run<span class="keyword"> </span>format</code><code class="line">npm<span class="keyword"> </span>run<span class="keyword"> </span><span class="colon">format</span>:check</code></pre></div><h3 id="usage-global">Globally (not recommended):</h3><p>you can install this library globally but the recommendation is to add the dependency and scripts to the package.json file.</p><p>this both explains to everyone that your app has this dependencies and keeps your bash free of clutter</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm<span class="keyword"> </span><span class="keyword">i</span> -<span class="keyword">g</span><span class="keyword"> </span>magic/test</code><code class="line"></code><code class="line"><code class="line comment">// run tests in production mode</code></code><code class="line"><span class="keyword">t</span> -<span class="keyword">p</span></code><code class="line"></code><code class="line"><code class="line comment">// run tests and get coverage in verbose mode</code></code><code class="line"><span class="keyword">t</span></code><code class="line"></code><code class="line"><code class="line comment">// check formatting using prettier but do not write</code></code><code class="line"><code class="line comment">// prettier --list-different</code></code><code class="line"><span class="keyword">f</span></code><code class="line"></code><code class="line"><code class="line comment">// format files using prettier</code></code><code class="line"><code class="line comment">// prettier --write</code></code><code class="line"><span class="keyword">f</span> -<span class="keyword">w</span></code></pre></div><p>This library tests itself, have a look at <a href="https://github.com/magic/test/tree/master/test" target="_blank" rel="noopener">the tests</a></p><p>Checkout [@magic/types](https://github.com/magic/types) and the other magic libraries for more test examples.</p></div><footer class="main"><div class="wrapper">made with a few bits of <a target="_blank" rel="noopener" href="https://github.com/magic/core">magic</a></div></footer></div></div><script type="text/javascript" src="/test/magic.js"></script></body></html>